# ä¸‰å¶è‰äºŒè¿›åˆ¶ç¬¬äºŒæ¬¡é¢è¯•ä¼˜ç§€è§£é¢˜æŠ¥å‘Š

ä¸‰å¶è‰æŠ€æœ¯å°ç»„äºŒè¿›åˆ¶æ–¹å‘ç¬¬äºŒæ¬¡æŠ€æœ¯é¢è¯•ä¸€å…±æœ‰ä¸ƒé“å¸¸è§„ CTF é€†å‘é¢˜ç›®ï¼Œæœ¬æ¬¡é¢è¯•ä¸»è¦é¢å‘å¤§ä¸€æ–°åŒå­¦ï¼Œä¸»è¦è€ƒå¯Ÿé¢è¯•åŒå­¦çš„é€†å‘åŸºç¡€åŠŸåº•ä»¥åŠå­¦ä¹ èƒ½åŠ›ã€‚

æˆ‘ä»¬é€‰æ‹©çš„çŸ¥è¯†ç‚¹æœ‰ä¸‰éƒ¨åˆ†

1. åŸºç¡€çŸ¥è¯† (å¼‚æˆ–ã€é™æ€åˆ†æã€åŠ¨æ€è°ƒè¯•ã€base64)
2. å­¦æ ¡è¯¾å ‚æ­£åœ¨å­¦ä¹ çš„çŸ¥è¯†ï¼ˆCè¯­è¨€ã€çº¿æ€§ä»£æ•°çŸ©é˜µä¹˜æ³•ï¼‰
3. æ²¡æœ‰æ¥è§¦è¿‡çš„çŸ¥è¯†ï¼ˆäºŒå‰æ ‘ã€C++å¼‚å¸¸ã€AESé™¤åˆ—æ··åˆéƒ¨åˆ†ï¼‰

å¯¹äºæœªæ¥è§¦è¿‡çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬ç»™å‡ºäº†è¯¦ç»†çš„å­¦ä¹ é“¾æ¥ä»¥åŠå­¦ä¹ æŒ‡å¯¼ã€‚

ç»è¿‡ä¸€ä¸ªæ˜ŸæœŸçš„è§£é¢˜æ—¶é—´ï¼Œæˆ‘ä»¬ä¸€å…±æ”¶åˆ° 23 ä»½æŠ¥å‘Šï¼Œå…¶ä¸­ 6 ä»½æŠ¥å‘Šå®Œæˆæ‰€æœ‰è€ƒæ ¸é¢˜ç›®ï¼ˆ5ä»½å¤§ä¸€æ–°ç”Ÿï¼Œ1ä»½ç ”ç©¶ç”Ÿæ–°ç”Ÿï¼‰



è¿™ç¯‡ writeup ç³…åˆäº†æ¥è‡ªä¸ƒä½åŒå­¦çš„è§£é¢˜æŠ¥å‘Š

é¢˜ç›®ä¸‹è½½: https://github.com/SycloverTeam/SycBinINTVW2021.git

## Level 1

è§£é¢˜äºº :  æ··å…¥ 21de è’Ÿè’»

SYC{PHQGlZhgsHfoFUWHUfExCUtJKxYeWJcuZvMwkrIENjSCAEwdyyRpHodDYa}

### é¢˜ç›®åˆ†æ

å¼€å§‹å‰å…ˆè´´ä¸€å¼ æˆ‘åˆ†æçš„ç¬”è®°~~ï¼ˆ é­å°¸æˆ‘è‡ªå·±ï¼Œè¿‡ç¨‹ä¸æ˜¯è¿™æ ·åˆ†æçš„ ï¼‰~~

![image-20211116213323876](pic/image-20211116213323876.png)

æœ€å¼€å§‹æ‹¿åˆ°é¢˜ç›®çš„æ—¶å€™å¤©çœŸçš„æˆ‘è¿˜æ²¡æœ‰è€ƒè™‘åˆ°äº‹æƒ…çš„ä¸¥é‡æ€§ï¼Œè¿˜æƒ³æ‰‹åŠ¨ Battle ä¸€ä¸‹åŒé‡å¾ªç¯çš„ä¸€ä¸ªå¼‚æˆ–ï¼Œè¿˜å‚»ä¹ä¹çš„ä»¥ä¸ºåœ¨åŠ¨è°ƒä¸‹å‘ç°äº†ä»€ä¹ˆå¤§ç§˜å¯†ï¼Œç»“æœæˆ‘é”™äº†~~ï¼ˆ æ•°æ®å˜åŒ–å¤ªæ€ªäº† ï¼‰~~

çªç„¶æƒ³èµ·æ¥å¼‚æˆ–æ˜¯ä¸€ä¸ªå¯é€†çš„åŠ å¯†è¿‡ç¨‹ï¼Œæœ‰åŸç† ï¼š

> è‹¥ C = A ^ B,
>
> åˆ™æœ‰ A ^ C == B 
>
> A ^ B == C 
>
> C ^ B == A  
>
> A ^ A == 0 
>
> B ^ B == 0
>
> å¼‚æˆ–ä¸€èˆ¬ç”¨äºåŠ å¯† åŠ å¯†è¿‡ç¨‹: 
>
> æ˜æ–‡ ^ å¯†é’¥ == å¯†æ–‡ 	è§£å¯†è¿‡ç¨‹: å¯†æ–‡ ^ å¯†é’¥ == æ˜æ–‡

è¿™ä¸ªæ—¶å€™æˆ‘æ‰æƒ³èµ·æ¥ä¸ºä»€ä¹ˆè¦æ‰‹åŠ¨æ¨æ¼”è¿™ä¸ªå¤æ‚çš„å¼‚æˆ–~~ï¼ˆé«˜è¾¾62*57æ¬¡è¿ç®—ï¼‰~~ï¼Œå› ä¸ºå¼‚æˆ–åœ¨äºŒè¿›åˆ¶ä¸‹ç›¸å½“äºåŠ æ³•ï¼ŒåŒæ—¶å­˜åœ¨ä¸Šè¿°çš„å¯é€†è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥é€†å‘åŒ–è§£é¢˜ç›®ä¸å°±å¯ä»¥å¾—åˆ° flag äº†å—ï¼Ÿ

åœ¨è§£é¢˜è¿‡ç¨‹ä¸­æˆ‘ä»¬å°† level 1 æ‹–å…¥ IDA ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ä»£ç ï¼š

![image-20211116213338393](pic/image-20211116213338393.png)

æˆ‘ä»¬ç®€æ˜“åˆ†æå…¶ç»„æˆï¼Œå¯ä»¥äº†è§£åˆ°è¾“å…¥çš„æ•°æ®é•¿åº¦ä¸º 63 ï¼Œåœ¨ä¸¤ä¸ª for çš„åŠ æŒï¼ˆå¾ªç¯ï¼‰ä¸‹å¾—åˆ°åŠ å¯†çš„åçš„ `s[i]`ï¼Œå¹¶åœ¨æœ€åå’Œ`compare_data[k]`è¿›è¡Œæ¯”è¾ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„çªç ´å£ä¾¿æ˜¯å¯¹è¿™ä¸ª`compare_data[k]`è¿›è¡Œåæ¨å…¶è¾“å…¥ï¼ˆ`s[i]`ï¼‰ï¼Œå› ä¸ºå¼‚æˆ–é€†è¿ç®—è¿˜æ˜¯å¼‚æˆ–ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š`A^B=C` é‚£ä¹ˆ C ä¾¿æ˜¯æˆ‘ä»¬è¿™ä¸ªé¢˜ç›®ä¸­å¼‚æˆ–åçš„ç»“æœï¼Œæˆ‘ä»¬å°† C å¼‚æˆ–å›å»ï¼Œ`C ^ B = ? ` è¿™ä¸ªé—®å·æ˜¯ä¸æ˜¯å°±æ˜¯æˆ‘ä»¬çš„ A ã€‚ç”±æ­¤æˆ‘ä»¬è¿›å…¥æ±‡ç¼–å±‚ï¼Œæå–å¯¹åº”`compare_data[k]`çš„æ•°æ®ï¼š

![image-20211116213410429](pic/image-20211116213410429.png)

ä¹‹åæˆ‘ä»¬ä¾¿å¯ä»¥å¼€å§‹ç¼–å†™è„šæœ¬äº†ã€‚



### é¢˜ç›®è§£ç­”

æˆ‘ä»¬æ ¹æ®å¼‚æˆ–å¯é€†çš„æ€§è´¨ç›´æ¥åå¼‚æˆ–å›å»å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¾“å…¥ï¼ˆ flag ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬ç¼–å†™å¯¹åº”è„šæœ¬å¦‚ä¸‹ï¼š

```c++
#include<iostream>
#include<cstring>
#include<cmath>
using namespace std;
int main() {
	char s[] = {
		0x89, 0x81, 0x0D, 0x37, 0x92, 0x88, 0x27, 0x33, 0x86, 0xB2,
		0xF6, 0xFB, 0x61, 0x58, 0xE0, 0xEB, 0x7C, 0x6D, 0xF9, 0xE4,
		0x77, 0x46, 0x93, 0xAC, 0x09, 0x1D, 0x8A, 0xB6, 0x39, 0x08,
		0xBF, 0x81, 0xCD, 0xD2, 0x6D, 0x79, 0xD8, 0xF6, 0x7B, 0x43,
		0xC1, 0xDA, 0x17, 0x19, 0x9C, 0xBA, 0x15, 0x07, 0xBB, 0xBD,
		0x19, 0x08, 0x9B, 0x99, 0xC4, 0xE4, 0x42, 0x67, 0xDA, 0xF8,
		0x6B, 0x51, 0xDB
	};


	char v1 = -85;
	int v2 =  0;
	for ( int i = 0; i <= 62; ++i ) {
		for ( int j = 0; j <= 57; ++j ) {
			v1 ^= j ^ v2 ^ 0xDA;
			s[i] ^= s[(i + 1) % 63];
			s[i] ^= v1;
			++v2;
		}
	}
	
	puts(s);
	return 0;
}
```

è¿è¡ŒæˆåŠŸåä¾¿æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¾“å…¥å•¦ï¼



## Level2

è§£é¢˜äºº: sanyic

IDA64æ‰“å¼€ï¼Œå‘ç°è¿›è¡Œäº†å¼‚æˆ–å’ŒRC4åŠ å¯†

![level2_1](pic/level2_1.png)

é™¤å»å¸¸è§„çš„ç¼–å†™è„šæœ¬é€†å‘å¤–ï¼Œå¯¹äºç‰¹æ®Šçš„æƒ…æ™¯å¯ä»¥æœ‰å…¶ä»–çš„æ€è·¯ã€‚

æˆ‘ä»¬å¯ä»¥å…ˆæ‰¾åˆ°æœ€åç”¨äºæ¯”è¾ƒçš„æ•°æ®ï¼Œç”±äºä¸¤æ­¥è¿ç®—éƒ½å±äºå¯¹ç§°æ€§è´¨çš„åŠ å¯†ï¼Œå¯¹æ¯”è¾ƒæ•°æ®å†åŠ å¯†å°±ç›¸å½“äºè§£å¯†ã€‚

å¼€å§‹åŠ¨æ€è°ƒè¯•

![level2_2](pic/level2_2.png)

ä» memcmp å‡½æ•°å¯ä»¥å¾—çŸ¥æœ€åçš„æ£€éªŒæœ‰ 54 ä¸ªå­—ç¬¦



åœ¨è¾“å…¥æ—¶å…ˆè¾“å…¥54 ä¸ªå¡«å……æ•°æ® (æ›¿æ¢æ‰è¾“å…¥çš„ a )ï¼Œå†ç”¨ lazyida è¿›è¡Œå¡«å……ï¼ˆéƒ¨åˆ†æ•°æ®å¯èƒ½å¯¹åº”ä¸å¯è§å­—ç¬¦ï¼Œæ— æ³•ç›´æ¥è¾“å…¥ï¼Œéœ€è¦é  lazyida åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­æ’å…¥ï¼‰

![level2_6](pic/level2_6.png)

å¡«å……ç»“æŸåï¼Œæ‰§è¡ŒåŠ å¯†ä»£ç ï¼Œå¯ä»¥å¾—åˆ° s çš„ç»“æœå¦‚ä¸‹: 

![level2_4](pic/level2_4.png)

Flagï¼šSYC{TOLSLFhyGZWaONYrPfZWRvTCmmKoUYNdfvjbQCCpaUBgsEnTQ}

![level2_5](pic/level2_5.png)

è§£è¿™é“é¢˜ä¸»è¦æ˜¯åˆ©ç”¨äº† RC4 åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ä¸€è‡´ï¼ŒåŠ å¯†è§£å¯†å‡½æ•°éƒ½æ˜¯ç›¸åŒçš„å‡½æ•°ï¼Œæˆ‘ä»¬å°†å¯†æ–‡æ•°æ®æå–å‡ºæ¥ä½œä¸ºè¾“å…¥å†åŠ å¯†ä¸€æ¬¡å³å¯å¾—åˆ°æ˜æ–‡ã€‚



## level3

è§£é¢˜äºº: å­™æ°¸çª

### ç¨‹åºé€»è¾‘ (ä»£ç +æ–‡å­—æè¿°)ï¼š

```c
input_string(v1);
base64_encode(v1,s1.33);
if(!memcmp(s1,s2,44uLL))
    puts("Yeah you win!!!! ~~");
```

ä»æ­¤å¯çœ‹å‡ºç¨‹åºé€»è¾‘å¤§è‡´ä¸ºï¼Œè¾“å…¥ flagï¼Œå°† flag è¿›è¡Œ base64 åŠ å¯†ï¼Œæœ€åå°†åŠ å¯†åçš„æ•°æ®ä¸ç›®æ ‡æ•°æ®è¿›è¡Œæ¯”å¯¹ã€‚

å¯ä»ä¸­çœ‹å‡ºæœ¬é¢˜ flag é•¿åº¦åº”ä¸º 33ï¼Œè€Œ s2 çš„æ•°æ®å¯é€šè¿‡IDAè°ƒè¯•è·å¾—ã€‚

åœ¨è¿™é‡Œæˆ‘ä»¬ä¸å¯¹æ­¤å¤„çš„åŠ å¯†å‡½æ•°è¿›è¡Œå…·ä½“åˆ†æï¼Œè½¬è€Œä»base64åŠ å¯†çš„åº•å±‚é€»è¾‘å‡ºå‘ï¼š

base64 ç¼–ç å°†ä¸‰ä¸ªå­—ç¬¦å¯¹åº”çš„ASCIIç çš„äºŒè¿›åˆ¶æ•°æ®ç”± 3X8 çš„å½¢å¼æ‹†åˆ†ä¸º 4X6 çš„å½¢å¼ç„¶åè¿›è¡Œå˜åŒ–åŠ å¯†ã€‚é‚£ä¹ˆæ˜¾ç„¶ï¼Œæ— è®ºä¸­é—´çš„ç®—æ³•æœ‰å¤šä¹ˆå¤æ‚ï¼Œä¸­é—´å‘ç”Ÿäº†ä½•ç§å˜æ¢ï¼Œ**ä¸€å®šå¯ä»¥æ‰¾åˆ°æœ€åˆçš„å…­ä½äºŒè¿›åˆ¶æ•°æ®ä¸åŠ å¯†åæ•°æ®çš„ä¸€ä¸€å¯¹åº”å…³ç³»**ï¼Œå³å¯æ‰¾åˆ°å¯¹åº”çš„ç ´è¯‘è¡¨ï¼Œè€Œç ´è¯‘è¡¨ä¸­æ•°æ®çš„è·å–å¯é€šè¿‡IDAè¿›è¡Œè°ƒè¯•è·å¾—ã€‚

### è§£é¢˜è„šæœ¬ï¼š

é‰´äºç¬”è€…èƒ½åŠ›æœ‰é™ï¼Œä¸‹é¢ä»…æä¾›ä¸€äº›æ¯”è¾ƒåŸºç¡€çš„è·å–ç ´è¯‘æ•°æ®çš„æ–¹æ³•ï¼š

### 1.æ•£å¼¹æ‰“é¸Ÿå‹

ç”¨ IDA æ‰“å¼€é¢˜ç›®æ–‡ä»¶ï¼Œåœ¨å¦‚ä¸‹ä½ç½®è®¾ç½®æ–­ç‚¹ï¼š

![](pic/QQå›¾ç‰‡20211108011748.png)

è¿›è¡Œè°ƒè¯•ï¼Œè¾“å…¥è‡ªå·±éœ€è¦è½¬åŒ–çš„æ•°æ®ï¼Œä»¥â€œaaaâ€ä¸ºä¾‹ï¼š

| åŸæ•°æ®                |    a     |    a     |    a     |
| --------------------- | :------: | :------: | :------: |
| å¯¹åº”ASCIIç äºŒè¿›åˆ¶æ•°æ® | 01100001 | 01100001 | 01100001 |

| æ‹†åˆ†å | 011000 | 010110 | 000101 | 100001 |
| ------ | :----: | ------ | :----: | ------ |

éšåæŸ¥çœ‹ s1 çš„å€¼ï¼š

![](pic/QQå›¾ç‰‡20211108013140.png)

å³å¯å¾—åˆ°ç ´è¯‘åçš„æ•°æ®ï¼š

| æ‹†åˆ†å | 011000 | 010110 | 000101 | 100001 |
| :----: | :----: | :----: | :----: | :----: |
| åŠ å¯†å |   E4   |   DF   |   B3   |   33   |

æ¥ä¸‹æ¥å°±æ˜¯é‡å¤ç±»ä¼¼è¿‡ç¨‹ï¼Œå¯æ ¹æ®ç ´è¯‘è¡¨ç¼ºå¤±çš„éƒ¨åˆ†çµæ´»è°ƒæ•´è¾“å…¥å€¼ä»¥è·å–æ‰€éœ€æ•°æ®ã€‚

ç„¶è€Œï¼Œä¸Šè¿°æ–¹æ³•åœ¨ç ´è¯‘è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“å‡ºç°æ•°æ®çš„é‡å¤æ”¶é›†è€Œå¯¼è‡´æ•ˆç‡çš„é™ä½ï¼Œè€Œä¸”é¢å¯¹ä¸€äº›ç‰¹æ®Šå€¼è­¬å¦‚000000ï¼Œä¸æ˜“ç›´æ¥æ‰¾åˆ°å…¶å¯¹åº”å­—ç¬¦ï¼Œä¸‹é¢æä¾›å¦ä¸€ç§æ–¹æ³•ï¼š

### 2.ç²¾å‡†æ‰“å‡»å‹

æ‰“å¦‚ä¸‹ä¸¤ä¸ªæ–­ç‚¹ï¼š

![](pic/QQå›¾ç‰‡20211108015131.png)

ç„¶åè¿›è¡Œè°ƒè¯•ï¼Œè¾“å…¥v1å€¼ï¼ˆæ­¤å¤„å¯éšæ„è¾“å…¥ï¼‰åï¼ŒåŒå‡»v1æŸ¥çœ‹å…¶åœ°å€ï¼š

![](pic/QQå›¾ç‰‡20211108015650.png)

æ¥ä¸‹æ¥ä½¿ç”¨ IDApython è„šæœ¬ï¼š

åˆ©ç”¨æŒ‡ä»¤ idc.patch_dbg_byte(va, value) ç›´æ¥å¯¹ v1 çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œå…·ä½“çš„ä¿®æ”¹å€¼å¯é€šè¿‡å¦‚ä¸‹æ–¹æ³•å¾—åˆ°ï¼š

```c
#include <stdio.h>
int main(void)
{
	unsigned char a[] = { 0B00000000,0B00010000,0B10000011,0B00010000,0B01010001,0B10000111,0B00100000,0B10010010,0B10001011,0B00110000,0B11010011,0B10001111,0B01000001,0B00010100,0B10010011,0B01010001,0B01010101,0B10010111,0B01100001,0B100101101,0B00110110,0B11100011,0B10101111,0B00111111,0B00000100,0B00110001,0B01000111,0B00100100,0B10110011,0B01001111,0B01000101,0B00110101,0B01010111,0B01100101,0B10110111,0B01011111,0B10000110,0B00111001,0B01100111,0B10100110,0B10111011,0B01101111,0B11000111,0B00111101,0B01110111,0B11100111,0B10111111,0B0111111 };
	for (int i = 0; i <= 47; i++)
	{
		printf("%d\n", a[i]);
	}
	return 0;
}
```

å¾—åˆ°ä¿®æ”¹å€¼å¦‚ä¸‹ï¼š

![](pic/QQå›¾ç‰‡20211108020542.png)

æ¥ä¸‹æ¥å¯¹v1ä¸­çš„å€¼ä¾æ¬¡è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å®Œæˆåç»§ç»­è°ƒè¯•è¿‡ç¨‹ï¼Œç„¶åå°†s1çš„æ•°æ®å¯¼å‡ºå³å¯å¾—åˆ°å¯¹åº”çš„ç ´è¯‘æ•°æ®ï¼Œæœ€ç»ˆå¾—åˆ°çš„ç ´è¯‘è¡¨å¦‚ä¸‹ï¼š

![](pic/QQå›¾ç‰‡20211108020905.png)

è€Œå·²çŸ¥ s2 çš„æ•°æ®ä¸ç ´è¯‘è¡¨ï¼Œè¿›è¡Œç ´è¯‘å³å¯å¾—åˆ°æœ€åˆçš„æ•°æ®ï¼Œå– s2 å‰å››ä½æ•°æ®ä¸ºä¾‹ï¼š

| s2               |   67   |   3F   |   07   |   58   |
| ---------------- | :----: | :----: | :----: | :----: |
| ç ´è¯‘åäºŒè¿›åˆ¶æ•°æ® | 010100 | 110101 | 100101 | 000011 |

| æœ€åˆå¯¹åº”çš„ASCIIç  | 01010011 | 01011001 | 01000011 |
| :---------------: | :------: | :------: | :------: |
|     å¯¹åº”å­—ç¬¦      |    S     |    Y     |    C     |

æ¥ä¸‹æ¥å¯¹æ•°æ®ä¾æ¬¡è¿›è¡Œç ´è¯‘åå³å¯è½»æ¾è§£å‡ºæ­¤é¢˜ FLAGï¼š

```c
#include <stdio.h>
int main(void)
{
	char a[] = { 0B01010011,0B01011001,0B01000011,0B01111011,0B01011001,0B01001000,0B01011000,0B01010110,0B01000001,0B01100011,0B01101010,0B01101010,0B01110000,0B01000111,0B01110011,0B01000010,0B01101100,0B01100110,0B01010100,0B01011010,0B01110111,0B01010001,0B01101011,0B01000110,0B01001011,0B01101111,0B01010111,0B01000110,0B01010111,0B01101110,0B01110010,0B01101110,0B01111101 };
	for (int i = 0; i <=32; ++i)
	{
		printf("%c", a[i]);
	}
	return 0;
}
```

æœ€ç»ˆå¾—åˆ° FLAG ä¸ºï¼šSYC{YHXVAcjjpGsBlfTZwQkFKoWFWnrn}

## level4

è§£é¢˜äºº: ä¹”é›ªé£-bj777-ç©ºä¿¡212

å…ˆçœ‹å£³ï¼Œ64 ä½ ELF æ–‡ä»¶ã€‚

![avatar](pic/image-20211108182236078.png)

æˆ‘ä»¬æ‹–åˆ° ida64 ä¸­æŸ¥çœ‹ï¼š

![avatar](pic/image-20211028003056516.png)

![avatar](pic/image-20211028003121093.png)

![avatar](pic/image-20211028003142999.png)

æˆ‘ä»¬å…ˆåŠ¨æ€è°ƒè¯•ä¸€æ ·çœ‹çœ‹å¤§æ¦‚çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨17è¡Œè®¾æ–­ç‚¹ï¼Œè¿è¡Œåˆ°19è¡Œï¼Œéœ€è¦è¾“å…¥flagï¼Œè¾“å…¥å®Œåç‹‚ç‚¹F8è¿›ç¨‹ç»“æŸã€‚

![image-20211115205225902](pic/image-20211115205225902.png)

ç„¶åæˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹ç¨‹åºï¼Œæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²å¦‚æœä¸ç­‰äº64å­—èŠ‚ï¼Œç›´æ¥exitäº†ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ªforå¾ªç¯çš„åµŒå¥—ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ªçŸ©é˜µï¼Œfor å¾ªç¯ä½œç”¨æ˜¯æŠŠ s    çŸ©é˜µä¸­çš„æ¯ä¸€ä½å¯¹åº”èµ‹å€¼ç»™ v9ï¼Œæ³¨æ„è¿˜æœ‰å¯èƒ½åˆ›å»ºä¸€ä¸ªè½¬ç½®çŸ©é˜µï¼Œä½†å‡ºé¢˜äººæ¯”è¾ƒå–„è‰¯ï¼Œå¹¶æ²¡æœ‰åˆ›å»ºè½¬ç½®çŸ©é˜µã€‚

æ¥ä¸‹æ¥æ˜¯ v10 çš„æ•°ç»„ï¼Œå†ç»è¿‡ä¸‹é¢çš„è¿ç®—ï¼Œè¿™ä¸ªè¿ç®—ä¸éš¾ç†è§£ï¼Œæ˜¯çŸ©é˜µçš„ç›¸ä¹˜ï¼Œå¦‚æœè¯¥çŸ©é˜µå¯é€†ï¼Œç›´æ¥ç”¨é€†çŸ©é˜µè§£å°±å¥½ã€‚

```c++
for ( k = 0; k <= 7; ++k )
  {
    for ( m = 0; m <= 7; ++m )
    {
      v5 = 0;
      for ( n = 0; n <= 7; ++n )
        v5 += v9[8 * k + n] * v10[8 * m + n];
      	v10[8 * k + 64 + m] = v5ï¼›

â€‹     }

}
```



æœ€åæ˜¯ **v10[8 * ii + 64 + jj] != compare_data_origin[8 * ii + jj]** ç›¸æ¯”ï¼Œç›¸ç­‰å°±æˆåŠŸäº†ï¼Œè¿™ä¸ªå¯ä»¥ä½œä¸ºä¸€ä¸ªåˆ¤å®šæ¡ä»¶ï¼Œå…¶å®å°±æ˜¯æ¯”è¾ƒä¸¤ä¸ªçŸ©é˜µç›¸ç­‰ã€‚

æ³¨æ„ï¼Œè¿™ä¸ª 64 æ˜¯æ‰©å¤§äº†åŸæœ‰ v10[64] è¿™ä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œå³å°†v10[64] â€”â€”> å˜ä¸ºv10[128],ä¸èƒ½ç†è§£æˆå°†v5èµ‹å€¼åˆ°v10[64]ä¸­ï¼Œè¿™æ ·çš„è¯ä¼šç›´æ¥ä½¿çŸ©é˜µæ¯ä¸€é¡¹çš„å€¼å‡å°‘è®¸å¤šï¼Œè‡ªç„¶å°±æ˜¯é”™çš„ã€‚

è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹z3åº“çš„åº”ç”¨

ç”¨ pip install z3-solver è¿›è¡Œå®‰è£…ã€‚

1.åˆ›å»ºä¸€ä¸ªè§£çš„å£°æ˜å¯¹è±¡ï¼š

```
s = Solver() 
```

2.æ·»åŠ æ¡ä»¶ï¼ˆç”¨æ¥çº¦æŸï¼‰ï¼š

```
s.add()
```

3.åˆ¤æ–­æ˜¯å¦æœ‰è§£ï¼š

```
s.check()
```

å¦‚æœæœ‰è§£ åˆ™åå›sate åä¹‹ è¿”å› unsate

4.è¿”å›æœ€åçš„è§£ï¼š

```
result=s.modul()
print(result)
```

è§£é‡Šä¸€ä¸‹ï¼šBitVec æ˜¯å­—ç¬¦æŒ‰ä½è¿ç®—ï¼ŒInt æ˜¯æ•´å½¢è¿ç®—ï¼Œåˆ¤å®šçš„æ¡ä»¶æ˜¯å‰4ä¸ªå­—ç¬¦æ˜¯â€˜SYC{â€™ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦æ˜¯â€˜}â€™ï¼Œæœ¬æ¥è¿˜å†™äº†å­—ç¬¦èŒƒå›´åœ¨A~Z,a~zï¼Œ0~9ï¼Œä½†å¸ˆå‚…è¯´ä¸ç”¨ã€‚è¿™ä¸ªç¡®å®æ²¡å¿…è¦ï¼Œä¸ä¼šåŠ å¿«å¤ªå¤šè¿ç®—æ—¶é—´ï¼Œè€Œä¸”æœ‰å¯èƒ½ä¼šå› ä¸ºå¤šä½™çš„æ¡ä»¶è€Œå¯¼è‡´å‡ºé”™ï¼å…¶ä¸­ assert æ˜¯æ–­è¨€ï¼Œå¦‚æœæœ‰è¿è¡Œé”™è¯¯ä¼šæŠ¥é”™ï¼Œæ˜¯ä¸ªä¸é”™çš„å·¥å…·ã€‚as_longæ˜¯å°†æ•°æ®è½¬æ¢ä¸º long å‹ï¼Œæˆ‘è‡ªè®¤ä¸ºæˆ‘çš„è„šæœ¬æ²¡é—®é¢˜ï¼Œæ‰€ä»¥å¬å–äº†å¸ˆå‚…çš„æ„è§ï¼Œä»£å…¥flagçš„å€¼ï¼Œé€šè¿‡åŠ¨æ€è°ƒè¯•å’Œè„šæœ¬è¾“å‡ºv10è¿›è¡Œå¯¹ç…§ï¼Œå¦‚æœä¸€è‡´è¯´æ˜æ²¡é—®é¢˜ï¼Œä¸ä¸€è‡´å°±æœ‰é—®é¢˜ã€‚æˆ‘è¯•äº†ä¸€ä¸‹ï¼Œæœ‰å¾ˆå¤§é—®é¢˜ï¼Œå€¼ä¸å€¼ä¹‹é—´å·®çš„å¤ªå¤šäº†ï¼Œæˆ‘åœ¨æƒ³ä¸ºä»€ä¹ˆè¿™æ ·å‘¢ï¼Œäºæ˜¯æˆ‘æŠŠç›®å…‰è½¬ç§»åˆ°æˆ‘å°‘åŠ çš„64èº«ä¸Šï¼Œå†æ¬¡ä¿®æ”¹ç¨‹åºï¼Œæˆ‘å°†comçš„èŒƒå›´æ‰©å¤§ï¼Œå˜æˆ128å†æ¬¡è®¡ç®—ï¼š

```python
from z3 import*
com=[ 381577, 378457,416889,326926,325667, 540807, 421653,408152,408162,391355,448648,330989,337540,569136,426635,397366,409633,428646,436722,346431,351918, 598158,483727,412569,411737, 424856, 454133, 336707, 360004,603891, 478253,438105, 422590, 444061, 448356,334117,360072,583110,481152,398828,479850,471394,
487198,373201,381606,650664,521561, 477718,397042,383879,393727, 288971,300614, 498219,402029,336256,420724,437969,472300,350451,377490,614352,488650,421868 ]
v10=[860,626,469,427,981359,733,115,279,431,807,413,581,670,748,714,412,298,993,716,389,464,772,879,667,216,221,367,869,151,223,425,188,327,732,319,454,500,758,922,902,423,784,518,798,998,854,426,559,734,496,159,780,959,796,527,894,306,817,112,781,699,181,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
s=Solver()
flag=[Int('flag%d'%i) for i in range(64)]

begin ="SYC{"
for i in range(len(begin)):
       s.add(flag[i] == ord(begin[i]))
s.add(flag[63] ==ord('}'))
v9 = [0 for _ in range(64)]
for i in range(8):
    for j in range(8):
        v9[i*8+j] = flag[i*8+j]
for k in range(8):
    for l in range(8):
        v5=0
        for m in range(8):
            v5+=v9[8*k+m] * v10[8*l+m]
        v10[8*k+64+l] =v5
for ii in range(8):
       for jj in range(8):
              s.add(v10[8*ii+64+jj] == com[8*ii+jj])
assert(s.check() == sat)

m = s.model()
res = []
for i in range(64):
    res.append(chr(m[flag[i]].as_long()))
s=''.join(res)
print(s)
```



å…¶ä¸­ join æ˜¯è®©å­—ç¬¦ä¸²è¿èµ·æ¥ã€‚

![avatar](pic/image-20211028010747315.png)

æˆåŠŸå¾—åˆ°flagï¼ï¼ï¼

**SYC{CvKAdyBlVDBjPlLFNtgzPsGtAcigBKhVlzamOvftexzOLNyIoDHMfUNhLla}**

## level5

è§£é¢˜äºº: gxh

### ç¨‹åºé€»è¾‘

ä¸€ä¸ªç®€åŒ–ç‰ˆçš„é­”æ”¹ AESï¼Œç›´æ¥æ‰‹é€†å³å¯

![Snipaste_2021-11-09_00-18-17](https://raw.githubusercontent.com/gxh191/Picture/main/Snipaste_2021-11-09_00-18-17.png)



### ç§˜é’¥æ‹“å±•

ç”±å›ºå®šçš„v5ç§˜é’¥å…ˆè¿›è¡Œç§˜é’¥æ‹“å±•ï¼Œå¾—åˆ°å›ºå®šçš„ v11ï¼Œç›´æ¥ lazyida æå– v11 å°±è¡Œ



### åŠ å¯†éƒ¨åˆ†

#### åŠ å¯†çš„ç¬¬ä¸€éƒ¨åˆ†

è¾“å…¥çš„48ä¸ªå­—ç¬¦åˆ†æˆ3ç»„ï¼Œä¸€ç»„16ä¸ªï¼Œä¸ v8 è¿›è¡Œå¼‚æˆ–ï¼Œï¼Œç¬¬ä¸€è½®ç»™çš„ v8 æ˜¯å›ºå®šçš„ï¼Œä»ç¬¬äºŒè½®å¼€å§‹ï¼Œv8å°±ç­‰äºä¸Šä¸€è½®ä¸Šæ¬¡ä¸€åŠ å¯†ä¹‹åçš„flag16ä¸ªå­—ç¬¦

#### åŠ å¯†çš„ç¬¬äºŒéƒ¨åˆ†

å¯¹16ä¸ªå­—ç¬¦è¿›è¡Œç®€åŒ–çš„aesåŠ å¯†ï¼Œå¤§è‡´åˆ†ä¸‰æ­¥ï¼Œç¬¬ä¸€æ­¥è½®ç§˜é’¥åŠ ï¼Œå°±æ˜¯ä¸ç§˜é’¥è¿›è¡Œå¼‚æˆ–ï¼Œç¬¬äºŒæ­¥è¿›è¡Œå­—èŠ‚ä»£æ¢ï¼Œå°±æ˜¯æ‹¿16ä¸ªå­—ç¬¦çš„æ¯ä¸€ä¸ªå­—èŠ‚ä½œä¸ºä¸‹æ ‡ï¼Œå»å–Sç›’ä¸­è¯¥ä¸‹æ ‡çš„å…ƒç´ è¿›è¡Œä»£æ¢ï¼Œç¬¬ä¸‰æ­¥è¿›è¡Œè¡Œç§»ä½

![Snipaste_2021-11-09_00-25-12](https://raw.githubusercontent.com/gxh191/Picture/main/Snipaste_2021-11-09_00-25-12.png)

è¡Œç§»ä½ä¼ªä»£ç åŠå…¶å›¾è§£

![Snipaste_2021-11-09_00-31-26](https://raw.githubusercontent.com/gxh191/Picture/main/Snipaste_2021-11-09_00-31-26.png)

![Snipaste_2021-11-09_00-31-16](https://raw.githubusercontent.com/gxh191/Picture/main/Snipaste_2021-11-09_00-31-16.png)



## è§£é¢˜æ€è·¯

ä»–åˆ†ä¸‰å—åŠ å¯†ï¼Œæˆ‘ä»¬å°±åˆ†ä¸‰å—é€†å‘å‘—



### æ•´ä½“é€†å‘è¿‡ç¨‹

è¡Œç§»ä½é€†å‘ -> å­—èŠ‚ä»£æ¢é€†å‘ -> å¼‚æˆ–ç§˜é’¥ -> å¼‚æˆ–ä¸Šä¸€è½®å¯†æ–‡



### è¡Œç§»ä½é€†å‘

ç›´æ¥ä¸€ä¸ªä¸€ä¸ªè¿˜åŸå›å»å°±è¡Œäº†ï¼Œéšä¾¿æ‹¿ä¸€ç»„è¡Œç§»ä½ä¸¾ä¾‹å­

```python
b2[0] = cmp3[0]
b2[1] = cmp3[13]
b2[2] = cmp3[10]
b2[3] = cmp3[7]
b2[4] = cmp3[4]
b2[5] = cmp3[1]
b2[6] = cmp3[14]
b2[7] = cmp3[11]
b2[8] = cmp3[8]
b2[9] = cmp3[5]
b2[10] = cmp3[2]
b2[11] = cmp3[15]
b2[12] = cmp3[12]
b2[13] = cmp3[9]
b2[14] = cmp3[6]
b2[15] = cmp3[3]
```



### å­—èŠ‚ä»£æ¢é€†å‘

ä¹Ÿæ˜¯éšä¾¿æ‹¿ä¸€ç»„ä¸¾ä¾‹

```python
for k in range(16):
    b2[k] = SBOX.index(b2[k])
```



### å…¶ä»–é€†å‘

å‰©ä¸‹çš„å°±æ˜¯ä¸€äº›ç®€å•çš„å¼‚æˆ–é€†å‘äº†ï¼Œå°±ä¸å•ç‹¬å†™äº†



### è§£é¢˜è„šæœ¬

```python
SBOX = [0x28, 0x90, 0xC3, 0x41, 0xC2, 0x75, 0x84, 0xDA, 0x79, 0xE7, 0x21, 0x0C, 0x81, 0xD5, 0xBF, 0x92, 0xB8, 0x4E, 0xB1, 0x2D, 0xED, 0x5C, 0xCB, 0x99, 0x6A, 0x32, 0x6F, 0xF2, 0x52, 0x4D, 0x29, 0x77, 0x49, 0x1D, 0xBB, 0x3A, 0x9F, 0x02, 0x1A, 0x71, 0x58, 0x72, 0xBA, 0xA1, 0x5E, 0xFA, 0x48, 0xF9, 0xFC, 0xF7, 0xA6, 0x97, 0x9D, 0x24, 0x0D, 0xE0, 0xF3, 0x37, 0x08, 0xEA, 0xF5, 0x6B, 0x86, 0xEF, 0x8D, 0x61, 0x65, 0x17, 0xD7, 0x7E, 0x13, 0x9C, 0xCC, 0x12, 0x33, 0x8E, 0x7D, 0x2F, 0x55, 0xCA, 0xAB, 0xE4, 0xFE, 0x45, 0xD6, 0xF6, 0xDE, 0xF1, 0x67, 0xE1, 0x0B, 0xB2, 0xAE, 0xCF, 0x7C, 0x04, 0x0E, 0x16, 0xA2, 0x00, 0xC6, 0xFF, 0x2C, 0x1E, 0x47, 0x30, 0xA4, 0x40, 0x4B, 0x15, 0x38, 0x35, 0xAF, 0x3E, 0x39, 0x3C, 0xD2, 0x85, 0xC7, 0x64, 0x89, 0xFD, 0xE8, 0x8B, 0x43, 0xC8, 0x22, 0x94, 0xA8, 0x31, 0xA3, 0xB9, 0x20, 0xEB, 0xB0, 0x01, 0x3D, 0x68, 0x5A, 0x93, 0x5B, 0x4F, 0x50, 0xE6, 0x6D, 0xF4, 0x44, 0x10, 0x80, 0xA7, 0x51, 0xD3, 0xC4, 0x2B, 0x88, 0x95, 0xA5, 0x70, 0x23, 0x18, 0x09, 0x4A, 0x19, 0x66, 0xDC, 0xEC, 0x14, 0xA9, 0xDB, 0xE2, 0x91, 0x4C, 0x57, 0x82, 0x1B, 0x2A, 0x11, 0x7B, 0x5D, 0x8A, 0xD4, 0xA0, 0x07, 0xD8, 0x53, 0x9B, 0x26, 0xD1, 0x98, 0x42, 0x0A, 0x9A, 0x1C, 0x8F, 0x5F, 0x63, 0xE9, 0xCD, 0xC1, 0x1F, 0x6C, 0xCE, 0xAC, 0xAA, 0xD0, 0x7F, 0x59, 0xBE, 0xB6, 0x46, 0xB7, 0x83, 0xEE, 0x7A, 0x9E, 0xC5, 0x62, 0x60, 0xF0, 0x8C, 0x2E, 0xC0, 0xDD, 0x73, 0x56, 0x76, 0x27, 0xB5, 0x25, 0x74, 0x6E, 0xC9, 0xDF, 0xB4, 0x34, 0x05, 0xD9, 0xB3, 0xBD, 0x3B, 0x54, 0xAD, 0x0F, 0x87, 0x78, 0xFB, 0x69, 0xF8, 0xBC, 0xE3, 0x96, 0x03, 0x3F, 0xE5, 0x06, 0x36]

v8 = ['v', 'M', 'B', 'i', 'x', 'p', 's', 'w', 'D', 'V', 'g', 'J', 'h', 'p', 'Z', 'd']
for i in range(len(v8)):
    v8[i] = ord(v8[i])

v11 = [0x58, 0x2F, 0x36, 0xDD, 0x92, 0xF2, 0x79, 0x09, 0xC8, 0x73, 0x6F, 0x0A, 0x36, 0x14, 0x6F, 0x43, 0xB7, 0x1A, 0x21, 0xD0, 0x25, 0xE8, 0x58, 0xD9, 0xED, 0x9B, 0x37, 0xD3, 0xDB, 0x8F, 0x58, 0x90, 0x55, 0x7D, 0x4C, 0x5C, 0x70, 0x95, 0x14, 0x85, 0x9D, 0x0E, 0x23, 0x56, 0x46, 0x81, 0x7B, 0xC6, 0x6C, 0xF6, 0x8D, 0x4F, 0x1C, 0x63, 0x99, 0xCA, 0x81, 0x6D, 0xBA, 0x9C, 0xC7, 0xEC, 0xC1, 0x5A, 0xA5, 0x79, 0x86, 0x50, 0xB9, 0x1A, 0x1F, 0x9A, 0x38, 0x77, 0xA5, 0x06, 0xFF, 0x9B, 0x64, 0x5C, 0x10, 0xBF, 0x28, 0x66, 0xA9, 0xA5, 0x37, 0xFC, 0x91, 0xD2, 0x92, 0xFA, 0x6E, 0x49, 0xF6, 0xA6, 0x42, 0xD6, 0x3C, 0x5E, 0xEB, 0x73, 0x0B, 0xA2, 0x7A, 0xA1, 0x99, 0x58, 0x14, 0xE8, 0x6F, 0xFE, 0x1D, 0xE3, 0x3A, 0xB3, 0xF6, 0x90, 0x31, 0x11, 0x8C, 0x31, 0xA8, 0x49, 0x98, 0xD9, 0xC7, 0xB7, 0x66, 0xFC, 0xE2, 0x77, 0x90, 0x6C, 0xD3, 0x66, 0x1C, 0x5D, 0x7B, 0x2F, 0x84, 0x84, 0xBC, 0x98, 0x70, 0x64, 0x26, 0x57, 0xE0, 0x08, 0xF5, 0x31, 0xFC, 0x55, 0x8E, 0x1E, 0x78, 0xD1, 0x32, 0x86, 0x36, 0xC2, 0x96, 0xDE, 0xD6, 0xCA, 0x63, 0xEF, 0x2A, 0x9F, 0xED, 0xF1, 0x52, 0x4E, 0xDF, 0x77, 0x63, 0xB1, 0xF2, 0x20, 0xB5, 0x7B, 0x91, 0xCF, 0x9F, 0xE4, 0x7C, 0x3E, 0xCD, 0xAA, 0xA3, 0x49, 0xF2, 0xD7, 0xE0, 0x5F, 0x47, 0xAC, 0x71, 0x90, 0xD8, 0x48, 0x0D, 0xAE, 0x15, 0xE2, 0xAE, 0xE7, 0xD5, 0xCC, 0x29, 0x03, 0x92, 0x60, 0x58, 0x93, 0x4A, 0x28, 0x55, 0x3D, 0x5F, 0xCA, 0xFB, 0xDA, 0x79, 0xCF, 0xD9, 0x07, 0xEB, 0xAF, 0x81, 0x94, 0xA1, 0x87, 0xD4, 0xA9, 0xFE, 0x4D, 0x2F, 0x73, 0x56, 0x36, 0xE5, 0x01, 0xBD, 0x99, 0x64, 0x95, 0x1C, 0x1E, 0xB0, 0x3C, 0xE2, 0x53, 0x9F, 0x4F, 0x13, 0x2E, 0x2F, 0x26, 0xAE, 0xB7, 0x4B, 0xB3, 0xB2, 0xA9, 0xFB, 0x8F, 0x50, 0xFA, 0x64, 0xC0, 0x85, 0xE8, 0x33, 0x8D, 0x2B, 0x5F, 0x78, 0x3E, 0x99, 0xF6, 0x83, 0xB1, 0xC9, 0x0C, 0xE7, 0x71, 0x04, 0x21, 0x0D, 0x43, 0x2F, 0x7E, 0x75, 0x7D, 0xB6, 0x88, 0xF6, 0xCC, 0x7F, 0x84, 0x11, 0xBD, 0x24, 0x6F, 0x4F, 0xD7, 0x0B, 0x11, 0x3A, 0xAA, 0xBD, 0x99, 0xCC, 0x66, 0xC2, 0x1D, 0xDD, 0xDB, 0x69, 0xAF, 0xC3, 0x88, 0x62, 0xBE, 0xF9, 0x22, 0xDF, 0x27, 0x35, 0x44, 0x1D, 0x3A, 0xE8, 0x9F, 0x61, 0x70, 0xDB, 0xC5, 0x03, 0xCE, 0x22, 0xE7, 0xDC, 0xE9, 0x17, 0xA3, 0xC1, 0xD3, 0xFF, 0x3C]
print(len(v11))

cmp3 = [0xDE, 0xF6, 0xA7, 0xB8, 0xF5, 0xD2, 0xF9, 0xFE, 0xD9, 0xA0, 0x13, 0xF3, 0x43, 0xEF, 0xB2, 0x8A]
cmp2 = [0x2E, 0xC3, 0xC3, 0x5F, 0x1E, 0x1C, 0x43, 0xE9, 0x1E, 0xE1, 0xB9, 0xBD, 0x85, 0x5B, 0x7A, 0x39]
cmp1 = [0xF8, 0x88, 0x9D, 0x31, 0xC7, 0x24, 0xD5, 0xF9, 0x45, 0x28, 0x9B, 0x7D, 0x42, 0x66, 0x65, 0x29]
b2 = [0] * 16

flag1 = ''
flag2 = ''
flag3 = ''

#v11[0]-v11[352]
#ç¬¬ä¸€ç»„è§£å¯†
p = 336 #352-16
for i in range(1):
    b2[0] = cmp3[0]
    b2[1] = cmp3[13]
    b2[2] = cmp3[10]
    b2[3] = cmp3[7]
    b2[4] = cmp3[4]
    b2[5] = cmp3[1]
    b2[6] = cmp3[14]
    b2[7] = cmp3[11]
    b2[8] = cmp3[8]
    b2[9] = cmp3[5]
    b2[10] = cmp3[2]
    b2[11] = cmp3[15]
    b2[12] = cmp3[12]
    b2[13] = cmp3[9]
    b2[14] = cmp3[6]
    b2[15] = cmp3[3]

    for k in range(16):
        b2[k] = SBOX.index(b2[k])

    for j in range(16):
        b2[j] ^= v11[p]
        p += 1

b3 = [0] * 16
p = 320#336-16
for i in range(21):
    b3[0] = b2[0]
    b3[1] = b2[13]
    b3[2] = b2[10]
    b3[3] = b2[7]
    b3[4] = b2[4]
    b3[5] = b2[1]
    b3[6] = b2[14]
    b3[7] = b2[11]
    b3[8] = b2[8]
    b3[9] = b2[5]
    b3[10] = b2[2]
    b3[11] = b2[15]
    b3[12] = b2[12]
    b3[13] = b2[9]
    b3[14] = b2[6]
    b3[15] = b2[3]

    for z in range(16):
        b2[z] = b3[z]

    for k in range(16):
        b2[k] = SBOX.index(b2[k])
    p = 320 - i * 16
    for j in range(16):
        b2[j] ^= v11[p]
        p += 1

for i in range(16):
    b2[i] ^= cmp2[i]

flag3 = bytes(b2).decode()


#ç¬¬äºŒç»„è§£å¯†
p = 336
for i in range(1):
    b2[0] = cmp2[0]
    b2[1] = cmp2[13]
    b2[2] = cmp2[10]
    b2[3] = cmp2[7]
    b2[4] = cmp2[4]
    b2[5] = cmp2[1]
    b2[6] = cmp2[14]
    b2[7] = cmp2[11]
    b2[8] = cmp2[8]
    b2[9] = cmp2[5]
    b2[10] = cmp2[2]
    b2[11] = cmp2[15]
    b2[12] = cmp2[12]
    b2[13] = cmp2[9]
    b2[14] = cmp2[6]
    b2[15] = cmp2[3]

    for k in range(16):
        b2[k] = SBOX.index(b2[k])

    for j in range(16):
        b2[j] ^= v11[p]
        p += 1

b3 = [0] * 16
p = 320
for i in range(21):
    b3[0] = b2[0]
    b3[1] = b2[13]
    b3[2] = b2[10]
    b3[3] = b2[7]
    b3[4] = b2[4]
    b3[5] = b2[1]
    b3[6] = b2[14]
    b3[7] = b2[11]
    b3[8] = b2[8]
    b3[9] = b2[5]
    b3[10] = b2[2]
    b3[11] = b2[15]
    b3[12] = b2[12]
    b3[13] = b2[9]
    b3[14] = b2[6]
    b3[15] = b2[3]

    for z in range(16):
        b2[z] = b3[z]

    for k in range(16):
        b2[k] = SBOX.index(b2[k])
    p = 320 - i * 16
    for j in range(16):
        b2[j] ^= v11[p]
        p += 1

for i in range(16):
    b2[i] ^= cmp1[i]

flag2 = bytes(b2).decode()


#ç¬¬ä¸‰ç»„è§£å¯†
p = 336
for i in range(1):
    b2[0] = cmp1[0]
    b2[1] = cmp1[13]
    b2[2] = cmp1[10]
    b2[3] = cmp1[7]
    b2[4] = cmp1[4]
    b2[5] = cmp1[1]
    b2[6] = cmp1[14]
    b2[7] = cmp1[11]
    b2[8] = cmp1[8]
    b2[9] = cmp1[5]
    b2[10] = cmp1[2]
    b2[11] = cmp1[15]
    b2[12] = cmp1[12]
    b2[13] = cmp1[9]
    b2[14] = cmp1[6]
    b2[15] = cmp1[3]

    for k in range(16):
        b2[k] = SBOX.index(b2[k])

    for j in range(16):
        b2[j] ^= v11[p]
        p += 1

b3 = [0] * 16
p = 320
for i in range(21):
    b3[0] = b2[0]
    b3[1] = b2[13]
    b3[2] = b2[10]
    b3[3] = b2[7]
    b3[4] = b2[4]
    b3[5] = b2[1]
    b3[6] = b2[14]
    b3[7] = b2[11]
    b3[8] = b2[8]
    b3[9] = b2[5]
    b3[10] = b2[2]
    b3[11] = b2[15]
    b3[12] = b2[12]
    b3[13] = b2[9]
    b3[14] = b2[6]
    b3[15] = b2[3]

    for z in range(16):
        b2[z] = b3[z]

    for k in range(16):
        b2[k] = SBOX.index(b2[k])
    p = 320 - i * 16
    for j in range(16):
        b2[j] ^= v11[p]
        p += 1

for i in range(16):
    b2[i] ^= v8[i]

flag1 = bytes(b2).decode()

print(flag1 + flag2 + flag3)
```

## level6
è§£é¢˜äºº: Smallcc

*flagï¼šSYC{lllllrllrrrlllrlrrrrrrrlrrrllrrlllrlrrrrrrrlrrrllrrl}*

### çŸ¥è¯†è¦æ±‚

â€‹	å…ˆçœ‹äºŒé¢é€šçŸ¥æ–‡ä»¶å…³äºè¿™é“é¢˜çš„æç¤º![image-20211107180220469](pic/image-20211107180220469.png)

â€‹	ä¸¤ä¸ªçŸ¥è¯†é‡ç‚¹ï¼š**é“¾è¡¨**     **äºŒå‰æ ‘**   

* é“¾è¡¨

  â€‹	é“¾è¡¨æœ‰å¤šç§ç±»å‹ï¼Œè€ƒè™‘åˆ°äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸€èˆ¬æœ‰ä¸‰ä¸ªåŸŸï¼Œå³å·¦å³å­æ ‘æŒ‡é’ˆåŠ ä¸€ä¸ªæ•°æ®åŸŸï¼Œå¤§è‡´çš„çœ‹äº†ä¸€ä¸‹é“¾è¡¨çš„ç›¸å…³çŸ¥è¯†åï¼Œå¾ˆå®¹æ˜“å‘ç°ï¼ŒäºŒå‰æ ‘çš„èŠ‚ç‚¹å’Œ**åŒå‘é“¾è¡¨**ç‰¹å¾åŸºæœ¬ä¸€è‡´ï¼Œä¸‹é¢æ˜¯å¯¹åŒå‘é“¾è¡¨çš„æè¿°ï¼š   

  â€‹	*åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œç»“ç‚¹é™¤å«æœ‰æ•°æ®åŸŸå¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªé“¾åŸŸï¼Œ**ä¸€ä¸ªå­˜å‚¨ç›´æ¥åç»§ç»“ç‚¹åœ°å€**ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸º**å³é“¾åŸŸ**ï¼›ä¸€**ä¸ªå­˜å‚¨ç›´æ¥å‰é©±ç»“ç‚¹åœ°å€**ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸º**å·¦é“¾åŸŸ**ã€‚*    

  â€‹	æ‰€ä»¥åªéœ€äº†è§£åŒå‘é“¾è¡¨çš„ç›¸å…³çŸ¥è¯†å³å¯

* äºŒå‰æ ‘

  â€‹	ç™¾åº¦è§£é‡Šï¼šäºŒå‰æ ‘æ˜¯nä¸ªæœ‰é™å…ƒç´ çš„é›†åˆï¼Œè¯¥é›†åˆæˆ–è€…ä¸ºç©ºã€æˆ–è€…ç”±ä¸€ä¸ªç§°ä¸ºæ ¹çš„å…ƒç´ åŠ**ä¸¤ä¸ªä¸ç›¸äº¤**çš„ã€è¢«åˆ†åˆ«ç§°ä¸º**å·¦å­æ ‘**å’Œ**å³å­æ ‘**çš„äºŒå‰æ ‘ç»„æˆï¼Œæ˜¯æœ‰åºæ ‘ã€‚å½“é›†åˆä¸ºç©ºæ—¶ï¼Œç§°è¯¥äºŒå‰æ ‘ä¸ºç©ºäºŒå‰æ ‘ã€‚åœ¨äºŒå‰æ ‘ä¸­ï¼Œä¸€ä¸ªå…ƒç´ ä¹Ÿç§°ä½œä¸€ä¸ªç»“ç‚¹

  â€‹	å›¾ç¤ºï¼š![img](https://bkimg.cdn.bcebos.com/pic/9213b07eca806538fa88f4329adda144ad3482b5?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U4MA==,g_7,xp_5,yp_5/format,f_auto) 

  â€‹		æ­¤å¤„å¯¹äº`FCE`è¿™ä¸ªç»„åˆï¼ŒFå³æ˜¯æ ¹ï¼ŒCä¸ºå·¦å­æ ‘ï¼ŒEä¸ºå³å­æ ‘ï¼›ç±»ä¼¼çš„å¯¹äº`CAD`è¿™ä¸ªç»„åˆï¼ŒAä¸ºå·¦å­æ ‘ï¼ŒDä¸ºå³å­æ ‘ï¼ŒCä¸ºæ ¹..

  â€‹		äº†è§£å·¦å³å­æ ‘ä¸æ ¹è¿™ä¸ªå…³ç³»ä¸»è¦æ˜¯æ–¹ä¾¿éå†ï¼Œ**ä½†æ˜¯æ­¤WPä¸æ¶‰åŠ**ï¼Œä»…ä¸ºçŸ¥è¯†æ‹“å±•

### åˆ†æè¿‡ç¨‹

å…ˆçœ‹å¾…åˆ†ææ–‡ä»¶åŸºæœ¬ä¿¡æ¯![image-20211107180331961](pic/image-20211107180331961.png)

â€‹	æ–‡ä»¶ç±»å‹ï¼šELF64   å­—èŠ‚åºï¼šLE

â€‹	è¿è¡Œ![image-20211107180404057](pic/image-20211107180404057.png)

â€‹		çœ‹ä¸å‡ºä»€ä¹ˆï¼Œç”¨IDA64æ‰“å¼€åˆ†æ

â€‹		main --> level6

â€‹	ä¸€è¿›å…¥ level6 å‡½æ•°ï¼Œå¼€å¤´å°±æ˜¯ä¸€å¤§ä¸²æ•°æ®ï¼Œå¤§è‡´çœ‹ä¸€ä¸‹å‡½æ•°å`build_tree`å’Œæ‹¬å·é‡Œé¢çš„å‡½æ•°ï¼Œå¯ä»¥å¤§è‡´åˆ¤æ–­å‡ºï¼Œè¿™åº”è¯¥å’ŒäºŒå‰æ ‘æ•°æ®ç±»å‹æœ‰å…³ç³»ï¼Œç»§ç»­åˆ†æ

â€‹	çœ‹è¿™æ®µå‡½æ•°

```c
 puts("This is level6! Do you know Binary Treeeee ?\n Can you find my secret in MY Forest ");
  puts("show me your flag:");
  input_string(haystack);
  if ( strstr(haystack, "SYC{") == haystack )   // åé¢å‚ä¸ç®—æ³•çš„haystackä¸ºâ€˜SYC{â€™ä¹‹åçš„å­—ç¬¦ä¸²
  {
    for ( i = 4; i < strlen(haystack) - 1; ++i )
    {
      v210 = haystack[i];
      if ( v210 == 108 )                        // å·¦é“¾
      {
        v212 = (_QWORD *)v212[1];
      }
      else if ( v210 == 114 )                   // å³é“¾
      {
        v212 = (_QWORD *)*v212;
      }
      if ( !v212 )
      {
        puts("You are lost in my forest!");
        return __readfsqword(0x28u) ^ v214;
      }
      if ( *((_DWORD *)v212 + 4) == 118806796 ) // v161
      {
        puts("Good! you find my secret!");
        return __readfsqword(0x28u) ^ v214;
      }
    }
    puts("Why? Don't stop!");
  }
  else
  {
    puts("No No No!");
  }
  return __readfsqword(0x28u) ^ v214;
}
```

â€‹	**for**å¾ªç¯é‡Œé¢çš„æ¡ä»¶è¯­å¥`strstr`å¤§æ¦‚æ„æ€å°±æ˜¯åˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„Inputæ˜¯å¦å«æœ‰`SYC{`

â€‹	ä¸‹é¢ çš„`for ( i = 4; i < strlen(haystack) - 1; ++i )`ï¼Œè¿™é‡Œçš„`for`å¾ªç¯ä¸­çš„`i`ä»4å¼€å§‹,æ¡ä»¶æ˜¯`i<len(Input)-1`,ä¹Ÿå°±æ˜¯è¯´å‚ä¸ç®—æ³•éƒ¨åˆ†çš„å­—ç¬¦ä¸²æ˜¯`xxxxxxxxxxxxxxxxxxxx}`ï¼Œå®ƒå¯¹é‡Œé¢å†…å®¹æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ

```c
 if ( v210 == 'l' )                        // å·¦é“¾
  {
    v212 = (_QWORD *)v212[1];
  }
```

â€‹		åŸå¼æ˜¯ `if ( v210 == 108 )`  å› ä¸ºä¸‹é¢ä¹Ÿæœ‰ç±»ä¼¼çš„è¡¨è¾¾ï¼Œä¸”108å’Œ114éƒ½æ˜¯å¯è§å­—ç¬¦ï¼ŒæŒ‰ R è½¬æ¢ä¸º char ï¼Œå˜æˆäº† 'l' å’Œ 'r'ï¼Œè¿™æ ·ä¸€çœ‹ï¼Œä¸ç”±è‡ªä¸»çš„æƒ³åˆ° left å’Œ right ï¼Œæ„Ÿè§‰...

â€‹		çœ‹ä¸‹é¢çš„  `v212 = (_QWORD *)v212[1];` ï¼Œåœ¨è¿™é‡Œåˆ†ææ˜¯è‚¯å®šçœ‹ä¸æ‡‚çš„ï¼Œå›åˆ°ä¸Šé¢çš„`build_tree`å‡½æ•°ï¼Œè¿›å»ï¼Œå°±ä¼šå‘ç°è¿™é‡Œæœ‰ä¸€æ ·çš„è¡¨è¾¾ï¼š

```c
_QWORD *__fastcall build_tree(__int64 a1, __int64 a2, int a3)
{
  _QWORD *result; // rax
  _DWORD var24; // [rsp+Ch] [rbp-24h]

  result = malloc(0x18uLL);                     // 24
  result[1] = a1;							 //å·¦å­æ ‘
  *result = a2;								 //å³å­æ ‘
  *((_DWORD *)result + 4) = a3;
  return result;
}
```

â€‹	å¯ä»¥çŒœå‡ºï¼š

â€‹		é€šè¿‡è¾“å…¥çš„ 'l' å’Œ 'r' ï¼Œå†³å®šè¿›å…¥å†…å­˜ã€‚è¾“å…¥ 'l' , èµ°å·¦å­æ ‘ï¼Œä½¿è½¬ç§»åˆ°å·¦é“¾åŸŸæŒ‡é’ˆæ‰€æŒ‡å†…å­˜ï¼Œè¾“å…¥ 'r' ,èµ°å³å­æ ‘ ï¼Œä½¿è½¬ç§»åˆ°å³é“¾åŸŸæŒ‡é’ˆæ‰€æŒ‡å†…å­˜ï¼Œæœ€åæ‰§è¡Œåˆ° '}' æ—¶ï¼Œæ—¢ä¸æ˜¯ 'l' ä¹Ÿä¸æ˜¯ 'r' ,æ­¤æ—¶è¿›å…¥æœ€åä¸€ä¸ª `if` è¯­å¥ï¼Œåˆ¤æ–­æ‰€å¤„é“¾è¡¨çš„æ•°æ®åŸŸæ˜¯å¦ç­‰äº`118806796`ï¼Œç­‰äºå³è¾“å‡º`"Good! you find my secret!"`ï¼Œä¹Ÿå°±æ˜¯ç­”æ¡ˆæ­£ç¡®ã€‚

â€‹		çŸ¥é“äº†åŸç†å’Œå¤§æ¦‚çš„è¿‡ç¨‹ï¼Œå†æ¥çœ‹ä¸Šé¢è¿™ä¸€å¤§ä¸²æ•°æ®ï¼Œå°±ä¼šå‘ç°ä»–ä»¬ç›¸äº’è¿æ¥ï¼Œæœ‰çš„å·¦å³é“¾åŸŸéƒ½æœ‰ï¼Œæœ‰çš„åªæœ‰ä¸€ä¸ªï¼Œæœ‰çš„ä¸€ä¸ªéƒ½æ²¡æœ‰ï¼Œè€Œæˆ‘ä»¬åˆå§‹å€¼æ˜¯ `v212` ,  æ•°æ®åŸŸ =`118806796` çš„æ˜¯`v161`ã€‚å³è¾“å…¥ 'l' å’Œ 'r' ç»„åˆèµ·æ¥çš„å­—ç¬¦ä¸² ï¼Œé€šè¿‡å·¦å³é“¾åŸŸèµ°åˆ°`v161`å¤„ï¼Œè¿™æœ‰ç‚¹ç±»ä¼¼äºå¯»è·¯ã€‚

### è§£é¢˜

â€‹		æˆ‘ä»¬äº†è§£äº†äºŒå‰æ ‘æ¨¡å‹ï¼Œ**å¯æŠŠv212ä½œä¸ºæ ¹**ï¼Œå¯ä»¥ç”»å‡ºå’Œ`v212`  `v161` ç›¸å…³çš„äºŒå‰æ ‘ï¼Œä¹Ÿå³è·¯çº¿å›¾(å…ˆè¯•è¯•v161èµ°åˆ°v212ï¼Œæœ‰äº†å°è±¡å†æ¥æ­£å‘èµ°ï¼‰![image-20211107180512945](pic/image-20211107180512945.png)

â€‹	å¤§æ¦‚å°±æ˜¯è¿™æ ·ï¼ˆå¯¼å‡ºä¸äº†ï¼Œå°±å°†å°±çœ‹å§ğŸ˜‚ï¼‰ï¼Œæ ¹æ®è·¯çº¿ï¼Œèµ°å·¦é“¾åŸŸå°±æ˜¯'l'ï¼Œèµ°å³é“¾åŸŸå°±æ˜¯'r'ï¼Œç…§ç€å†™å°±æ˜¯äº†ï¼Œæœ€åå†™å‡ºæ¥æ˜¯`SYC{lllllrllrrrlllrlrrrrrrrlrrrllrrlllrlrrrrrrrlrrrllrrl}`

â€‹	æ‹¿åˆ°è™šæ‹Ÿæœºä¸ŠéªŒè¯ä¸€ä¸‹![image-20211107180559286](pic/image-20211107180559286.png)

â€‹	OKï¼ŒæˆåŠŸæ‰¾åˆ°äº†ä»–çš„ secret

***

â€‹	è¿™é“é¢˜çš„æ­£ç¡®çš„è§£é¢˜åº”è¯¥æ˜¯è°ƒè¯•æå–äºŒå‰æ ‘æ•°æ®ï¼Œç»“åˆäºŒå‰æ ‘éå†çš„çŸ¥è¯†ï¼Œç”¨è„šæœ¬è§£é¢˜ï¼Œè¿™å¾—ç»§ç»­å­¦ä¹ ï¼Œä»¥åç”¨ä»£ç å¤ç°ä¸€ä¸‹ã€‚

## level7

è§£é¢˜äººï¼šé—»é“ƒ

### ç®€å•åˆ†æé¢˜ç›®

ç”¨ida64æ‰“å¼€ç¨‹åº

```c
_int64 level7(void)
{
  __int64 s1[4]; // [rsp+20h] [rbp-90h] BYREF
  char input[104]; // [rsp+40h] [rbp-70h] BYREF
  unsigned __int64 v3; // [rsp+A8h] [rbp-8h]

  v3 = __readfsqword(0x28u);
  s1[0] = 0LL;
  s1[1] = 0LL;
  s1[2] = 0LL;
  s1[3] = 0LL;
  puts("This is level7! Are you a master of CPP exceptions?");
  puts("show me your flag:");
  input_string(input);
  if ( strlen(input) != 16 )                    // åˆ¤æ–­é•¿åº¦
  {
    puts("try a..g..i.....n.");
    exit(-1);
  }
  enc((unsigned __int8 *)input, (unsigned __int8 *)s1);// åŠ å¯†ä¸»ä½“
  if ( !memcmp(s1, &unk_55F60C281026, 0x10uLL) )
  {
    puts("Yeah you win!");
    puts("Yeah you win!");
    puts("Yeah you win!");
    puts("Yeah you win!");
  }
  else
  {
    puts("Ohhhh, TRY HARD");
  }
  return 0LL;
}
```

ç¨‹åºçš„é€»è¾‘å¾ˆç®€å•ï¼Œè·å–è¾“å…¥---->éªŒè¯é•¿åº¦---->åŠ å¯†---->å¯¹æ¯”

æ‰€ä»¥è¯¦ç»†åˆ†æ enc å‡½æ•°å°±è¡Œäº†

```c
void __fastcall enc(unsigned __int8 *a1, unsigned __int8 *a2)
{
  _DWORD *v2; // rax
  _QWORD *v3; // rax
  _BYTE *v4; // rax
  last_struct *v5; // rbx
  int i; // [rsp+3Ch] [rbp-84h]
  int v7; // [rsp+40h] [rbp-80h]
  int v8; // [rsp+50h] [rbp-70h]

  for ( i = 0; i <= 31; ++i )
  {
    v7 = 0;
    srand(0x73737963u);
    do
    {
      v8 = rand();
      if ( v8 == 0x5B897F00 )
      {
        v3 = __cxa_allocate_exception(8uLL);
        *v3 = 0x4050AA3D70A3D70ALL;
        __cxa_throw(v3, (struct type_info *)&`typeinfo for'double, 0LL);
      }
      if ( v8 <= 0x5B897F00 )
      {
        if ( v8 == 0x6C1C8AC )
        {
          v2 = __cxa_allocate_exception(4uLL);
          *v2 = 666;
          __cxa_throw(v2, (struct type_info *)&`typeinfo for'int, 0LL);
        }
        if ( v8 == 0x4396D767 )
        {
          v4 = __cxa_allocate_exception(1uLL);
          *v4 = 102;
          __cxa_throw(v4, (struct type_info *)&`typeinfo for'char, 0LL);
        }
      }
      ++v7;
    }
    while ( v7 != 3 );
  }
  v5 = (last_struct *)__cxa_allocate_exception(1uLL);
  last_struct::last_struct(v5);
  __cxa_throw(v5, (struct type_info *)&`typeinfo for'last_struct, 0LL);
}
```

ä½†æ˜¯encå‡½æ•°çš„é€»è¾‘å°±ä¸æ˜¯å¾ˆæ¸…æ™°äº†

ä½†æ˜¯encå‡½æ•°ä¸­å‘ç°äº†ä¸å°‘ exception å’Œ throwï¼Œå³ä½¿é¢˜ç›®ä¸ç»™æç¤ºï¼Œä»è¿™é‡Œä¹Ÿå¯ä»¥æ¨æ–­å‡ºè¿™æ˜¯ä¸€é“C++å¼‚å¸¸å¤„ç†çš„é€†å‘é¢˜ç›®

ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹C++å¼‚å¸¸å¤„ç†æœºåˆ¶



### C++å¼‚å¸¸å¤„ç†æœºåˆ¶

```c++
try
{
    ...
    if()
    {
    	throw ...
    }
}catch()
{
    ...
}
```

è¿™å°±æ˜¯C++å¼‚å¸¸å¤„ç†çš„ä¸€èˆ¬æ¨¡å¼

é¦–å…ˆåœ¨ try è¯­å¥å—ä¸­æ‰§è¡Œä»£ç ï¼Œä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœæ»¡è¶³æŸç§æ¡ä»¶ï¼Œå°±æ˜¯ throw (æŠ›å‡º)ä¸ä¹‹å¯¹åº”çš„å¼‚å¸¸

æ¥ç€ä¸è¿™ä¸ªå¼‚å¸¸å¯¹åº”çš„catchå—å°±ä¼šæ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œä»è€Œæ‰§è¡Œcatchå—ä¸­çš„å¼‚å¸¸å¤„ç†ä»£ç 

æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªC++å¼‚å¸¸å¤„ç†çš„å®ä¾‹ï¼š

```c++
//æ‘˜å–è‡³èœé¸Ÿæ•™ç¨‹https://www.runoob.com/cplusplus/cpp-exceptions-handling.html
#include <iostream>
using namespace std;
 
double division(int a, int b)
{
   if( b == 0 )
   {
      throw "Division by zero condition!";
   }
   return (a/b);
}
 
int main ()
{
   int x = 50;
   int y = 0;
   double z = 0;
 
   try {
     z = division(x, y);
     cout << z << endl;
   }catch (const char* msg) {
     cerr << msg << endl;
   }
 
   return 0;
}
```

åœ¨mainå‡½æ•°ä¸­ï¼Œç¨‹åºè°ƒç”¨ division å‡½æ•°æ‰§è¡Œä¸€æ¬¡é™¤æ³•ï¼Œåœ¨ division å‡½æ•°ä¸­è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœé™¤æ•°ä¸º0åˆ™æŠ›å‡º"Division by zero condition!"å¼‚å¸¸ï¼Œæ¥ç€ catch å—ä¼šæ•è·ä¸€ä¸ªç±»å‹ä¸ºå­—ç¬¦ä¸²çš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢é™¤æ•°ä¸º0æ—¶æŠ›å‡ºçš„å¼‚å¸¸

è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®C++å¼‚å¸¸å¤„ç†æœºåˆ¶å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå¤æ‚åŒ–çš„**if-else**è¯­å¥å—ï¼Œä½†æ˜¯ç”±äºå…¶ç‰¹æ®Šçš„åŠŸèƒ½ï¼ˆå¤„ç†ç¨‹åºä¸­å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸ï¼‰è€Œé‡‡å–äº†æ›´åŠ å¤æ‚çš„è¯­æ³•ï¼Œå…¶æœ¬è´¨æ¨¡å¼è¿˜æ˜¯**åˆ¤æ–­+ç›¸åº”å¤„ç†**ï¼Œè¿™ä¸if-elseå¤§åŒå°å¼‚

### è¯¦ç»†åˆ†æé¢˜ç›®

#### ç¡®å®šæ‰§è¡Œæµç¨‹

![image-20211107201116705](pic/image-20211107201116705.png)

ä»ä¸Šå›¾ä¸­ä¸éš¾å‘ç°ï¼šå‰ä¸‰ä¸ªthrowå¿«éƒ½åŒ…å«åœ¨ifè¯­å¥å—ä¸­ï¼Œåˆ¤æ–­çš„æ¡ä»¶æ˜¯ä¼ªéšæœºæ•°çš„å€¼

æˆ‘ä¹ˆä»¬åœ¨ç›¸åŒçš„ç¯å¢ƒä¸‹ï¼ˆLinux-C/Linux-C++ï¼‰å†™ä¸€ä¸ªä¼ªéšæœºæ•°ç”Ÿæˆä»£ç 

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(void)
{
 	 unsigned int seed = 0x73737963;
 	 int i;
 	 int j;
 	 int v8;
 	 for(i=0; i<32; i++)
 	 {
 	 	int v7 = 0;
 	 	srand(seed);
 	 	do
 	 	{
 	 		v8 = rand();
 	 		printf("%#X, ", v8);
 	 		++v7;
 	 	}while(v7 != 3);
 	 }
 	 return 0;  
}
```

![image-20211107201718830](pic/image-20211107201718830.png)

å¯ä»¥çœ‹å‡ºç”Ÿæˆçš„ä¼ªéšæœºæ•°æ˜¯3ä¸ªä¸€ç»„ï¼Œè€Œä¸”æ¯ä¸ªæ•°å€¼éƒ½æœ‰å¯¹åº”çš„ifåˆ¤æ–­è¯­å¥

ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ¨æ–­ï¼Œæ¯æ¬¡forå¾ªç¯çš„æ‰§è¡Œé¡ºåºéƒ½æ˜¯ï¼šç¬¬äºŒä¸ªif---->ç¬¬ä¸€ä¸ªif---->ç¬¬ä¸‰ä¸ªif

å¾ªç¯ç»“æŸåæœ‰ä¸€ä¸ªæ— æ¡ä»¶çš„throwå—



#### åˆ†ç¦»catchå—ï¼Œè¿˜åŸæ­£å‘ç®—æ³•

åŸå§‹çš„ä¼ªä»£ç ä¸­æ˜¯çœ‹ä¸åˆ°catchå—çš„ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°æ±‡ç¼–ä»£ç 

â€‹	![image-20211107202434595](pic/image-20211107202434595.png)

![image-20211107202510334](pic/image-20211107202510334.png)

åœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†begin_catchã€end_catchçš„å­—æ ·ï¼Œè¿™äº›å°±æ˜¯catchå—

ä½†æ˜¯åœ¨æ±‡ç¼–ä»£ç ä¸­æˆ‘ä»¬è¿˜æ˜¯çœ‹ä¸å‡ºthrowä¸catchçš„å¯¹åº”å…³ç³»ï¼Œå…¶å®æ˜¯å¯ä»¥é€šè¿‡é™æ€åˆ†æå¾—åˆ°å¯¹åº”å…³ç³»çš„ï¼Œä½†æ˜¯é‚£æ ·åšå¤ªéº»çƒ¦äº†

æˆ‘ä»¬åœ¨æ¯ä¸ªcatchå—çš„å¼€å¤´ä¸‹æ–­ç‚¹ï¼Œè®©åè®©ç¨‹åºè·‘èµ·æ¥ï¼Œæ¯ä¸ªthrowä¹‹åçœ‹ç¨‹åºæ–­åœ¨å“ªé‡Œï¼Œå°±å¯ä»¥å¾—åˆ°throwä¸catchçš„å¯¹åº”å…³ç³»äº†

æ‰¾åˆ°å¯¹åº”å…³ç³»å‘¨ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹è¿˜åŸä¼ªä»£ç äº†

è¿™é‡Œæˆ‘é‡‡ç”¨çš„æ–¹æ³•æ˜¯æ‰‹æ’¸æ±‡ç¼–ï¼Œæœ‰å…´è¶£è¿™æ ·åšçš„æœ‹å‹å¯ä»¥å»çœ‹ä¸€çœ‹ã€ŠC++åæ±‡ç¼–ä¸é€†å‘åˆ†ææŠ€æœ¯æ­ç§˜ã€‹ï¼Œä¹¦ä¸­è¯¦ç»†åˆ†æäº†é«˜çº§è¯­è¨€çš„æ±‡ç¼–è¡¨ç¤ºæ–¹å¼

é™æ€ä¸‹æ’¸æ±‡ç¼–ç¡®å®ä¸æ˜¯æ˜æ™ºçš„é€‰æ‹©ï¼Œä½†æ˜¯å¦‚æœæ˜¯åŠ¨æ€ï¼Œè¿™ä¸ªå·¥ä½œé‡å°±å°å¤ªå¤šäº†

é‡å¤å•æ­¥ä¸æŸ¥çœ‹å†…å­˜çš„æ­¥éª¤ï¼Œæˆ‘å½“æ—¶å¥½åƒæ˜¯ç”¨äº†å°†è¿‘ä¸‰ä¸ªå°æ—¶å°±è¿˜åŸäº†æ­£å‘ç®—æ³•

ç”¨pythonå†™å‡ºæ¥æ˜¯è¿™æ ·çš„

```python
delta = 0x9e3779b9
delta_arr =[0xb9, 0x79, 0x37, 0x9e]
key = 0
flag = [0x34333231, 0x38373635, 0x34333231, 0x38373635] #æµ‹è¯•æ•°æ®
result = []
for i in range(32):
    key = (key+delta)&0xffffffff

    temp1 = flag[1]
    flag[0] += (((temp1<<4)&0xffffffff)+8) ^ ((temp1+key)&0xffffffff) ^ (((temp1>>5)&0xffffffff)+6) ^ ((key+i)&0xffffffff)
    flag[0] &= 0xffffffff

    temp2 = flag[3]
    flag[2] += (((temp2<<4)&0xffffffff)+8) ^ ((temp2+key)&0xffffffff) ^ (((temp2>>5)&0xffffffff)+6) ^ ((key+i)&0xffffffff)
    flag[2] &= 0xffffffff

    temp3 = flag[0]
    flag[1] += (((temp3<<4)&0xffffffff)+9) ^ ((temp3+key)&0xffffffff) ^ (((temp3>>5)&0xffffffff)+7) ^ ((key+i)&0xffffffff)
    flag[1] &= 0xffffffff

    temp4 = flag[2]
    flag[3] += (((temp4<<4)&0xffffffff)+9) ^ ((temp4+key)&0xffffffff) ^ (((temp4>>5)&0xffffffff)+7) ^ ((key+i)&0xffffffff)
    flag[3] &= 0xffffffff
   
    
    #for i in flag:
    #    print(hex(i))
    #print("\n")


result.append(delta_arr[3]^flag[0])
result.append(delta_arr[2]^flag[1])
result.append(delta_arr[1]^flag[2])
result.append(delta_arr[0]^flag[3])


for i in result:
    print(hex(i))

```

æœ€åå°±æ˜¯å†™è„šæœ¬äº†

```python
result = [0xA3A7C060, 0xEE6E5485, 0x244B2655, 0x318482D9]
delta_arr = []
delta = 0x9e3779b9
delta_list = [0xb9, 0x79, 0x37, 0x9e]
key = 0
for i in range(32):
    key += delta
    delta_arr.append(key&0xffffffff)
result[0] ^= delta_list[3]
result[1] ^= delta_list[2]
result[2] ^= delta_list[1]
result[3] ^= delta_list[0]
#print(result)

for i in range(31, -1, -1):
    temp4 = result[2]
    result[3] -= (((temp4<<4)&0xffffffff)+9) ^ ((temp4+delta_arr[i])&0xffffffff) ^ (((temp4>>5)&0xffffffff)+7) ^ ((delta_arr[i]+i)&0xffffffff)
    result[3] &= 0xffffffff

    temp3 = result[0]
    result[1] -= (((temp3<<4)&0xffffffff)+9) ^ ((temp3+delta_arr[i])&0xffffffff) ^ (((temp3>>5)&0xffffffff)+7) ^ ((delta_arr[i]+i)&0xffffffff)
    result[1] &= 0xffffffff

    temp2 = result[3]
    result[2] -= (((temp2<<4)&0xffffffff)+8) ^ ((temp2+delta_arr[i])&0xffffffff) ^ (((temp2>>5)&0xffffffff)+6) ^ ((delta_arr[i]+i)&0xffffffff)
    result[2] &= 0xffffffff

    temp1 = result[1]
    result[0] -= (((temp1<<4)&0xffffffff)+8) ^ ((temp1+delta_arr[i])&0xffffffff) ^ (((temp1>>5)&0xffffffff)+6) ^ ((delta_arr[i]+i)&0xffffffff)
    result[0] &= 0xffffffff



flag_list = []
flag_str = ''
for i in result:
    flag_list.append(hex(i))
flag_list = [i[2:] for i in flag_list]
print(flag_list)
for i in flag_list:
    for j in range(4):
        flag_str += chr(int(i[-2:], 16))
        i = i[:-2]
print(flag_str)    

```

